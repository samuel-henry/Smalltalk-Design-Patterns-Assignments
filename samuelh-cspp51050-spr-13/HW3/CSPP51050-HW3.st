Object subclass: #PhFMMHardware	instanceVariableNames: 'controlValues maxValues'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!PhFMMHardware methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 00:53'!controlValues	"get the current control values with lazy initialization if not created yet"	^ controlValues ifNil:[controlValues := Dictionary new]! !!PhFMMHardware methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 03:35'!controlValues: someValues	"update control values with the passed in values, but make sure that each value is less than or equal to its corresponding maximum volume"	someValues associationsDo: [ :assoc | self controlValues at: (assoc key) put: (assoc value min: (self maxValues at: assoc key)). ].! !!PhFMMHardware methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 00:45'!maxValues	| maxValues |	maxValues := Dictionary new.	maxValues at: 'PSI' put: 200.	maxValues at: 'AMPS' put: 200.	^ maxValues! !!PhFMMHardware methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 12:58'!start! !!PhFMMHardware methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 12:59'!stop! !Object subclass: #PhFMMMachineControl	instanceVariableNames: 'hardware runTime recipe'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 15:07'!controlValues	"get control values from hardware layer"	^ hardware controlValues! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 15:07'!controlValues: someValues	"send control values to hardware layer"	hardware controlValues: someValues.! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 12:45'!execute	| file psi amps isValid |		recipe isNil 		ifTrue: [ file := FileDirectory default forceNewFileNamed: 'Manual.DAS.csv'. 				psi := self controlValues at: 'PSI'.				amps := self controlValues at: 'AMPS'.				file nextPutAll: 'MANUAL'; cr.				1 to: runTime do: [ :elapsedTime | 	psi := self controlValues at: 'PSI'.													amps := self controlValues at: 'AMPS'.													file nextPutAll: elapsedTime asString; nextPutAll: ','; nextPutAll: psi  asString; 														nextPutAll: ','; nextPutAll: amps asString; cr. ].				file close.				isValid := true]		ifFalse: [ self recipe createPart.				 isValid := self isValidExecution ].		 ^ isValid! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/19/2013 16:20'!hardware	^ hardware! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/19/2013 16:20'!hardware: someHardware	hardware := someHardware! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 17:29'!initialize	hardware := PhFMMHardware new.	runTime := 0.! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 12:43'!isValidExecution	| referenceFile referenceFileContents DASFile DASFileContents |		referenceFile := FileDirectory default readOnlyFileNamed: (self recipe recipeFileName, '.reference.csv').	DASFile := FileDirectory default readOnlyFileNamed: (self recipe recipeFileName, '.DAS.csv').		referenceFileContents := referenceFile skipSeparators contentsOfEntireFile.	DASFileContents := DASFile skipSeparators contentsOfEntireFile .	^ referenceFileContents = DASFileContents! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/19/2013 16:37'!recipe	^ recipe! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 16:27'!recipe: aRecipe	recipe := aRecipe.! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 16:35'!runTime	^ runTime! !!PhFMMMachineControl methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 16:04'!runTime: someTime	runTime := someTime.! !Object subclass: #PhFMMUserInterface	instanceVariableNames: 'machineControl'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!PhFMMUserInterface methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 15:05'!controlValues	^ machineControl controlValues.! !!PhFMMUserInterface methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 15:05'!controlValues: someValues	machineControl controlValues: someValues.! !!PhFMMUserInterface methodsFor: 'as yet unclassified' stamp: 'sjh 5/19/2013 16:33'!executeRecipe: aRecipe	machineControl recipe: aRecipe.	^ machineControl execute.! !!PhFMMUserInterface methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 15:00'!initialize	machineControl := PhFMMMachineControl new.! !!PhFMMUserInterface methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 16:33'!manualRunFor: time	machineControl runTime: time.	machineControl recipe: nil.	machineControl execute.	! !!PhFMMUserInterface methodsFor: 'accessing' stamp: 'sjh 5/19/2013 16:18'!machineControl	^ machineControl! !!PhFMMUserInterface methodsFor: 'accessing' stamp: 'sjh 5/19/2013 16:18'!machineControl: anObject	machineControl := anObject! !Object subclass: #Recipe	instanceVariableNames: 'machineControl recipeName mode partSize recipeFileName'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!Recipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 17:58'!createPart	^ self subclassResponsibility! !!Recipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/19/2013 16:37'!initializeWithFile: fileName	| file contents tokens |	recipeFileName := fileName.	file := (FileStream fileNamed: fileName) readOnly text.	contents := file contentsOfEntireFile asString.		tokens := contents findTokens: $,.	recipeName := tokens at: 1.	mode := tokens at: 2.	partSize := (tokens at: 3) asNumber.! !!Recipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 00:06'!initializeWithFile: fileName for: aMachineControl	| file contents tokens |	machineControl := aMachineControl.	recipeFileName := fileName.	file := (FileStream fileNamed: fileName) readOnly text.	contents := file contentsOfEntireFile asString.		tokens := contents findTokens: $,.	recipeName := tokens at: 1.	mode := tokens at: 2.	partSize := (tokens at: 3) asNumber.! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!machineControl	^ machineControl! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!machineControl: anObject	machineControl := anObject! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!mode	^ mode! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!mode: anObject	mode := anObject! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!partSize	^ partSize! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 17:58'!partSize: anObject	partSize := anObject! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/19/2013 16:38'!recipeFileName	^ recipeFileName! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/19/2013 16:38'!recipeFileName: anObject	recipeFileName := anObject! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 19:16'!recipeName	^ recipeName! !!Recipe methodsFor: 'accessing' stamp: 'sjh 5/17/2013 19:16'!recipeName: anObject	recipeName := anObject! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Recipe class	instanceVariableNames: ''!!Recipe class methodsFor: 'as yet unclassified' stamp: 'sjh 5/17/2013 18:04'!fromFile: fileName	^ self basicNew initializeWithFile: fileName! !!Recipe class methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 00:06'!fromFile: fileName for: aMachineControl	^ self basicNew initializeWithFile: fileName for: aMachineControl! !Recipe subclass: #ConstantCurrentRecipe	instanceVariableNames: 'controlValues'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!ConstantCurrentRecipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 03:57'!createPart	"ConstantCurrent: T = { 0...20 }, PSI = 50 - (T * 2) where PSI can never get below 10, AMPS (constant) = part size + 50"	| outputFile amps |		"append .DAS.csv to recipe file name to create output file"	outputFile := FileDirectory default forceNewFileNamed: (recipeFileName, '.DAS.csv').			"set output stream to convert smalltalk carriage returns to regular carriage returns"	outputFile wantsLineEndConversion: true.		"instantiate control values"	controlValues := Dictionary new.		amps := self partSize + 50.	outputFile nextPutAll: mode.				0 to: 20 do: [ :elapsedTime | 	controlValues at: 'PSI' put: (200 min: (10 max: (50 - (elapsedTime * 2)))); at: 'AMPS' put: amps.												self machineControl controlValues: controlValues.												outputFile cr; nextPutAll: elapsedTime asString, ',', (machineControl controlValues at: 'PSI') asString, ',', (machineControl controlValues at: 'AMPS') asString.].	outputFile close.! !Recipe subclass: #ConstantPressureRecipe	instanceVariableNames: 'controlValues'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!ConstantPressureRecipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 03:57'!createPart	"ConstantPressure: T (time, in seconds) = { 0, 1,...10 }, PSI (should remain constant) = part size + 100, AMPS = T * 2"	| outputFile psi |	"append .DAS.csv to recipe file name to create output file"	outputFile := FileDirectory default forceNewFileNamed: (recipeFileName, '.DAS.csv').		"set output stream to convert smalltalk carriage returns to regular carriage returns"	outputFile wantsLineEndConversion: true.		"set constant pressure value"	psi := partSize + 100.		"instantiate control values"	controlValues := Dictionary new.		outputFile nextPutAll: mode.	0 to: 10 do: [ :elapsedTime | controlValues at: 'PSI' put: psi; at: 'AMPS' put: (elapsedTime * 2).								 self machineControl controlValues: controlValues.								 outputFile 	nextPutAll: String cr, elapsedTime asString, ',', (machineControl controlValues at: 'PSI') asString, ',', (machineControl controlValues at: 'AMPS') asString.].												outputFile close.! !Recipe subclass: #RampRecipe	instanceVariableNames: 'controlValues'	classVariableNames: ''	poolDictionaries: ''	category: 'CSPP51050-HW3'!!RampRecipe methodsFor: 'as yet unclassified' stamp: 'sjh 5/20/2013 03:57'!createPart	"Ramp: T = { 0...30 }, PSI = ramp up from 0 to 100, in 10 PSI increments each second and then hold at 100,  AMPS = ramp up, starting from part size, in 20 AMP increments each second. Only part sizes of 50 or above can be used. If a recipe has a smaller part size, the MachineControl must generate an error. This part size restriction only applies to the Ramp recipe."	| outputFile |		"input validation"	partSize < 50		ifTrue: [ self error: 'Part size must be >= 50' ].			"append .DAS.csv to recipe file name to create output file"	outputFile := FileDirectory default forceNewFileNamed: (recipeFileName, '.DAS.csv').		"set output stream to convert smalltalk carriage returns to regular carriage returns"	outputFile wantsLineEndConversion: true.		"instantiate control values"	controlValues := Dictionary new.		outputFile nextPutAll: mode.				0 to: 30 do: [ :elapsedTime | 	controlValues at: 'PSI' put: (100 min: (elapsedTime * 10)); at: 'AMPS' put: (200 min: (50 + (elapsedTime * 20))).												self machineControl controlValues: controlValues.												outputFile 	cr; nextPutAll: elapsedTime asString; nextPutAll: ','; 															nextPutAll: (machineControl controlValues at: 'PSI') asString; nextPutAll: ','; 															nextPutAll: (machineControl controlValues at: 'AMPS') asString.].	outputFile close.! !